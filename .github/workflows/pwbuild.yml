# This is a basic workflow that is manually triggered

name: PipeWire builder

# Controls when the action will run. Workflow runs when manually triggered using the UI
# or API.
on:
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "greet"
  greet:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    container: archlinux:latest
    
    steps:
      - uses: actions/checkout@v2
      - name: Compile
        run: |
          echo -e "[multilib]\nInclude = /etc/pacman.d/mirrorlist" >> /etc/pacman.conf
          pacman -Syu --noconfirm base-devel sudo git
          useradd user -G wheel && echo "user ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers
          chown user -R .
          echo -e "PACKAGER=\"Ihor Yemaiev <mynameiskitsune@proton.me>\"\nGPGKEY=\"11AB43077E240E19EA773113128753272FB3D91D\"" >> /etc/makepkg.conf
          git clone https://aur.archlinux.org/pipewire-full-git.git ./pw
          chown user -R ./pw
          cd ./pw
          su user -c "yes|PKGDEST=/tmp/pw makepkg --noconfirm -s"
          
      - name: Archive the artifacts
        uses: actions/upload-artifact@v2
        with:
          name: dump
          path: /tmp/pw
          
          
